# Comprehensive 策略 - TradingView 版本

将 `backpack_quant_trading/strategy/comprehensive.py` 多指标综合策略适配为 TradingView Pine Script (v5) 可回测格式。

## 使用方法

1. 登录 [TradingView](https://www.tradingview.com)
2. 打开任意图表，底部点击「Pine 编辑器」
3. 将 `comprehensive.pine` 全部内容复制到编辑器中
4. 点击「添加到图表」
5. 在策略属性中可调整参数，然后运行回测

## 策略逻辑

- **多指标评分**：趋势、价格位置、RSI、K线形态、成交量、KDJ、OBV、均线、MACD
- **趋势过滤**：顺势交易（uptrend 做多，downtrend 做空）
- **MA50 过滤**：做多需价在 MA50 上方，做空需价在 MA50 下方
- **布林带宽度**：BB_WIDTH < 阈值不开仓
- **止盈止损**：按百分比（默认 TP 0.5%，SL 0.4%）
- **技术止盈**：RSI 超买/超卖、趋势反转
- **冷却期**：平仓后 N 根 K 线内不再开仓

## 优化说明（v2）

- **MACD 优先模式**：默认开启，仅以 MACD 金叉/死叉 + 趋势开仓，类似单 MACD 策略，更稳定
- **盈亏比**：TP 0.8% / SL 0.35%（约 2.3:1）
- **冷却期**：平仓后 15 根 K 线内不再开仓
- **MACD 必选过滤**：综合模式下需 MACD 柱状线与方向一致

## 参数说明

| 参数 | 默认值 | 说明 |
|------|--------|------|
| MACD 优先模式 | 开启 | 以 MACD 为核心，更稳定 |
| 止盈 % | 0.8 | 止盈百分比 |
| 止损 % | 0.35 | 止损百分比 |
| 平多 RSI 阈值 | 68 | RSI 高于此值技术止盈 |
| 平空 RSI 阈值 | 32 | RSI 低于此值技术止盈 |
| RSI 超卖(做多) | 40 | 做多时 RSI 低于此值加分 |
| RSI 超买(做空) | 60 | 做空时 RSI 高于此值加分 |
| 最少满足条件数 | 3 | 至少 N 个条件才开仓 |
| 最低加权分 | 4.0 | 加权评分需达到此值 |
| MA50 过滤 | true | 是否启用 MA50 过滤 |
| 最小布林带宽度 | 0.01 | 过窄不开仓 |
| 允许做空 | true | 是否允许做空 |
| 平仓后冷却K线数 | 5 | 冷却期内不开新仓 |

## 适用品种

- 股票、期货、外汇、加密货币等可回测品种
- 推荐周期：日线、4H、1H（根据品种调整）

## 注意事项

1. 策略默认使用 15% 仓位、0.1% 手续费，可在 `strategy()` 中修改
2. 止盈止损按 **K 线收盘价** 判断，非实时触发
3. 图表会显示 MA5、MA20、MA50、布林带及买卖信号
